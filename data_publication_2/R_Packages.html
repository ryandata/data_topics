<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Ryan Womack">
<meta name="dcterms.date" content="2023-08-15">

<title>R_Packages</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="R_Packages_files/libs/clipboard/clipboard.min.js"></script>
<script src="R_Packages_files/libs/quarto-html/quarto.js"></script>
<script src="R_Packages_files/libs/quarto-html/popper.min.js"></script>
<script src="R_Packages_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="R_Packages_files/libs/quarto-html/anchor.min.js"></script>
<link href="R_Packages_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="R_Packages_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="R_Packages_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="R_Packages_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="R_Packages_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">


</head>

<body>

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
  <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#r-packages" id="toc-r-packages" class="nav-link active" data-scroll-target="#r-packages"><span class="header-section-number">1</span> R Packages</a>
  <ul class="collapse">
  <li><a href="#the-r-packages-book-by-wickham-and-bryan" id="toc-the-r-packages-book-by-wickham-and-bryan" class="nav-link" data-scroll-target="#the-r-packages-book-by-wickham-and-bryan"><span class="header-section-number">1.1</span> The R packages book, by Wickham and Bryan</a></li>
  <li><a href="#install-and-load-packages" id="toc-install-and-load-packages" class="nav-link" data-scroll-target="#install-and-load-packages"><span class="header-section-number">1.2</span> Install and load packages</a></li>
  <li><a href="#outline-of-the-creation-of-a-little-package" id="toc-outline-of-the-creation-of-a-little-package" class="nav-link" data-scroll-target="#outline-of-the-creation-of-a-little-package"><span class="header-section-number">1.3</span> Outline of the creation of a little package</a></li>
  <li><a href="#create_package-function" id="toc-create_package-function" class="nav-link" data-scroll-target="#create_package-function"><span class="header-section-number">1.4</span> Create_package function</a></li>
  </ul></li>
  </ul>
<div class="quarto-alternate-formats"><h2>Other Formats</h2><ul><li><a href="R_Packages.pdf"><i class="bi bi-file-pdf"></i>PDF</a></li><li><a href="R_Packages.docx"><i class="bi bi-file-word"></i>MS Word</a></li></ul></div></nav>
</div>
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">R_Packages</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Ryan Womack </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">August 15, 2023</p>
    </div>
  </div>
  
    
  </div>
  

</header>

<section id="r-packages" class="level2" data-number="1">
<h2 data-number="1" class="anchored" data-anchor-id="r-packages"><span class="header-section-number">1</span> R Packages</h2>
<section id="the-r-packages-book-by-wickham-and-bryan" class="level3" data-number="1.1">
<h3 data-number="1.1" class="anchored" data-anchor-id="the-r-packages-book-by-wickham-and-bryan"><span class="header-section-number">1.1</span> The R packages book, by Wickham and Bryan</h3>
<p>This is a brief introduction to R package creation, taking as its text the book <a href="https://r-pkgs.org">R Packages, 2nd edition</a> by Hadley Wickham and Jennifer Bryan. This book is freely available on the web, so please consult for further details of topics that are only outlined here. The second edition has been finalized in June 2023.</p>
</section>
<section id="install-and-load-packages" class="level3" data-number="1.2">
<h3 data-number="1.2" class="anchored" data-anchor-id="install-and-load-packages"><span class="header-section-number">1.2</span> Install and load packages</h3>
<p>The fundamental packages required to create an R package are <em>devtools</em>, <em>roxygen2</em>, and <em>testthat</em>. Please install these with the following commands if they are not already available on your system. These will not install by default if you just attempt to run this R markdown file.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">"devtools"</span>, <span class="at">dependencies=</span><span class="cn">TRUE</span>)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">"roxygen2"</span>, <span class="at">dependencies=</span><span class="cn">TRUE</span>)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">"testthat"</span>, <span class="at">dependencies=</span><span class="cn">TRUE</span>)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>devtools<span class="sc">::</span><span class="fu">session_info</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Let’s load those libraries now.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(devtools)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: usethis</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(roxygen2)</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(testthat)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'testthat'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following object is masked from 'package:devtools':

    test_file</code></pre>
</div>
</div>
<p>We can check that we’re running recent enough versions of our software with the <em>packageVersion</em> command for indivual packages, or <em>session_info</em> for our entire setup.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">packageVersion</span>(<span class="st">"devtools"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] '2.4.5'</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>devtools<span class="sc">::</span><span class="fu">session_info</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>─ Session info ───────────────────────────────────────────────────────────────
 setting  value
 version  R version 4.2.2 Patched (2022-11-10 r83330)
 os       Debian GNU/Linux 12 (bookworm)
 system   x86_64, linux-gnu
 ui       X11
 language (EN)
 collate  en_US.UTF-8
 ctype    en_US.UTF-8
 tz       America/New_York
 date     2023-08-16
 pandoc   3.1.1 @ /usr/lib/rstudio/resources/app/bin/quarto/bin/tools/ (via rmarkdown)

─ Packages ───────────────────────────────────────────────────────────────────
 package     * version date (UTC) lib source
 brio          1.1.3   2021-11-30 [2] CRAN (R 4.0.4)
 cachem        1.0.8   2023-05-01 [2] CRAN (R 4.2.2)
 callr         3.7.3   2022-11-02 [2] CRAN (R 4.2.1)
 cli           3.6.1   2023-03-23 [2] CRAN (R 4.2.2)
 crayon        1.5.2   2022-09-29 [2] CRAN (R 4.2.1)
 devtools    * 2.4.5   2022-10-11 [2] CRAN (R 4.2.2)
 digest        0.6.33  2023-07-07 [2] CRAN (R 4.2.2)
 ellipsis      0.3.2   2021-04-29 [2] CRAN (R 4.0.4)
 evaluate      0.21    2023-05-05 [2] CRAN (R 4.2.2)
 fastmap       1.1.1   2023-02-24 [2] CRAN (R 4.2.2)
 fs            1.6.3   2023-07-20 [2] CRAN (R 4.2.2)
 glue          1.6.2   2022-02-24 [2] CRAN (R 4.1.2)
 htmltools     0.5.5   2023-03-23 [2] CRAN (R 4.2.2)
 htmlwidgets   1.6.2   2023-03-17 [2] CRAN (R 4.2.2)
 httpuv        1.6.11  2023-05-11 [2] CRAN (R 4.2.2)
 jsonlite      1.8.7   2023-06-29 [2] CRAN (R 4.2.2)
 knitr         1.43    2023-05-25 [2] CRAN (R 4.2.2)
 later         1.3.1   2023-05-02 [2] CRAN (R 4.2.2)
 lifecycle     1.0.3   2022-10-07 [2] CRAN (R 4.2.1)
 magrittr      2.0.3   2022-03-30 [2] CRAN (R 4.1.3)
 memoise       2.0.1   2021-11-26 [2] CRAN (R 4.0.4)
 mime          0.12    2021-09-28 [2] CRAN (R 4.0.4)
 miniUI        0.1.1.1 2018-05-18 [2] CRAN (R 4.2.2)
 pkgbuild      1.4.2   2023-06-26 [2] CRAN (R 4.2.2)
 pkgload       1.3.2.1 2023-07-08 [2] CRAN (R 4.2.2)
 prettyunits   1.1.1   2020-01-24 [2] CRAN (R 4.0.4)
 processx      3.8.2   2023-06-30 [2] CRAN (R 4.2.2)
 profvis       0.3.8   2023-05-02 [2] CRAN (R 4.2.2)
 promises      1.2.0.1 2021-02-11 [2] CRAN (R 4.0.4)
 ps            1.7.5   2023-04-18 [2] CRAN (R 4.2.2)
 purrr         1.0.1   2023-01-10 [2] CRAN (R 4.2.2)
 R6            2.5.1   2021-08-19 [2] CRAN (R 4.0.4)
 Rcpp          1.0.11  2023-07-06 [2] CRAN (R 4.2.2)
 remotes       2.4.2.1 2023-07-18 [2] CRAN (R 4.2.2)
 rlang         1.1.1   2023-04-28 [2] CRAN (R 4.2.2)
 rmarkdown     2.23    2023-07-01 [2] CRAN (R 4.2.2)
 roxygen2    * 7.2.3   2022-12-08 [2] CRAN (R 4.2.2)
 rstudioapi    0.15.0  2023-07-07 [2] CRAN (R 4.2.2)
 sessioninfo   1.2.2   2021-12-06 [2] CRAN (R 4.0.4)
 shiny         1.7.4.1 2023-07-06 [2] CRAN (R 4.2.2)
 stringi       1.7.12  2023-01-11 [2] CRAN (R 4.2.2)
 stringr       1.5.0   2022-12-02 [2] CRAN (R 4.2.2)
 testthat    * 3.1.10  2023-07-06 [2] CRAN (R 4.2.2)
 urlchecker    1.0.1   2021-11-30 [2] CRAN (R 4.2.2)
 usethis     * 2.2.2   2023-07-06 [2] CRAN (R 4.2.2)
 vctrs         0.6.3   2023-06-14 [2] CRAN (R 4.2.2)
 xfun          0.39    2023-04-20 [2] CRAN (R 4.2.2)
 xml2          1.3.5   2023-07-06 [2] CRAN (R 4.2.2)
 xtable        1.8-4   2019-04-21 [2] CRAN (R 4.0.4)
 yaml          2.3.7   2023-01-23 [2] CRAN (R 4.2.2)

 [1] /home/ryan/R/x86_64-pc-linux-gnu-library/4.2
 [2] /usr/local/lib/R/site-library
 [3] /usr/lib/R/site-library
 [4] /usr/lib/R/library

──────────────────────────────────────────────────────────────────────────────</code></pre>
</div>
</div>
</section>
<section id="outline-of-the-creation-of-a-little-package" class="level3" data-number="1.3">
<h3 data-number="1.3" class="anchored" data-anchor-id="outline-of-the-creation-of-a-little-package"><span class="header-section-number">1.3</span> Outline of the creation of a little package</h3>
<p>We’ll follow along with <a href="https://r-pkgs.org/whole-game.html">Chapter 1</a> of the R Packages book and walk through the creation of a little package, even simpler than the “toy package” presented in the text.</p>
<p>This will enable us to review the fundamental features of a typical package:</p>
<ul>
<li>functions</li>
<li>version control</li>
<li>documentation (<em>roxygen2</em>)</li>
<li>testing (<em>testthat</em>)</li>
<li>creation of a README.Rmd file</li>
</ul>
<p>After we do this for our little package, we’ll coverage some additional details relating to the steps above.</p>
</section>
<section id="create_package-function" class="level3" data-number="1.4">
<h3 data-number="1.4" class="anchored" data-anchor-id="create_package-function"><span class="header-section-number">1.4</span> Create_package function</h3>
<p>We call <em>create_package</em> to initiate a package. We want to start this in its own fresh directory, not a pre-existing project or git repository. The <em>create_package</em> function will set up the necessary folder structure for a package. Please <em>EDIT</em> the contents of the command below to correspond to your computer’s file system. This is the one place in the code where you’ll have to modify it. Note that to be a valid package name and to be allowed on CRAN, the package name should:</p>
<ul>
<li>Contain only ASCII letters, numbers, and ‘.’</li>
<li>Have at least two characters</li>
<li>Start with a letter</li>
<li>Not end with ‘.’</li>
</ul>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="fu">create_package</span>(<span class="st">"/home/ryan/R/littlePackage"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>✔ Setting active project to '/home/ryan/R/littlePackage'</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Package: littlePackage
Title: What the Package Does (One Line, Title Case)
Version: 0.0.0.9000
Authors@R (parsed):
    * First Last &lt;first.last@example.com&gt; [aut, cre] (YOUR-ORCID-ID)
Description: What the package does (one paragraph).
License: `use_mit_license()`, `use_gpl3_license()` or friends to pick a
    license
Encoding: UTF-8
Roxygen: list(markdown = TRUE)
RoxygenNote: 7.2.3</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>✔ Setting active project to '&lt;no active project&gt;'</code></pre>
</div>
</div>
<p>This will launch a new window. To be able to continue using our script here, just close that window and navigate in the original window to the package directory (same as what you used above), either via the RStudio Files window or with the following <em>setwd</em> command (modified with the directory you used). Alternatively, you could open the markdown file in the new session, but be sure to rerun the library commands in lines 30-32 above.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="fu">setwd</span>(<span class="st">"/home/ryan/R/littlePackage"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>The “dot files” beginning with a period (.) are used to store a history of the R session and to tell R and git to ignore certain files. Generally we can leave these files as is and let R worry about how to handle them. You shouldn’t need to modify these files in most circumstances.</p>
<p>Likewise, the .Rproj file is usually left unmodified. This helps RStudio manage the package folder as a project.</p>
<p>The NAMESPACE is also a file we won’t edit. It is used to keep track of relations between functions that your package will use, but you can let RStudio handle this.</p>
<p>One of the two locations that we <em>WILL</em> edit are the <em>DESCRIPTION</em>, which is a structured way of providing information about your package. This is what you will see when you look up the function in the R help system, or what would be displayed if your package makes it onto CRAN. For example, try typing ?testthat to see the description of that package.</p>
<p>The other is the <em>R</em> folder. This is the folder that we will put our functions into. Optionally we could add a <em>data</em> folder as well, if we wanted to distribute data via our package.</p>
<p>It is quite convenient to use <em>create_package</em> to take care of all of this for us.</p>
</section>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>